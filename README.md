# ะะพะผะฟะปะตะบัะฝัะน ะะ-ะฐะณะตะฝั: ClickHouse + Python Analysis

ะะฝัะตะปะปะตะบััะฐะปัะฝัะน ะฐะณะตะฝั ะดะปั ะฐะฝะฐะปะธะทะฐ ะดะฐะฝะฝัั, ะบะพัะพััะน ะพะฑัะตะดะธะฝัะตั ะฒะพะทะผะพะถะฝะพััะธ ัะฐะฑะพัั ั ะฑะฐะทะพะน ะดะฐะฝะฝัั ClickHouse ะธ Python-ะฐะฝะฐะปะธะทะฐ ั ะฒะธะทัะฐะปะธะทะฐัะธะตะน.

## ๐ฏ ะะพะทะผะพะถะฝะพััะธ

- ๐๏ธ **ะััะผะพะต ะฟะพะดะบะปััะตะฝะธะต ะบ ClickHouse** - ะฒัะณััะทะบะฐ ะดะฐะฝะฝัั ะธะท ะฑะฐะทั ะดะฐะฝะฝัั
- ๐ **Python ะฐะฝะฐะปะธะท** - ะพะฑัะฐะฑะพัะบะฐ ะดะฐะฝะฝัั ั ะฟะพะผะพััั pandas, numpy
- ๐ **ะะธะทัะฐะปะธะทะฐัะธั** - ะฟะพัััะพะตะฝะธะต ะณัะฐัะธะบะพะฒ ั matplotlib ะธ seaborn
- ๐ฌ **ะััะพัะธั ะดะธะฐะปะพะณะฐ** - ัะพััะฐะฝะตะฝะธะต ะบะพะฝัะตะบััะฐ ัะฐะทะณะพะฒะพัะฐ ะฒ SQLite
- ๐ค **Claude Sonnet 4** - ะผะพัะฝะฐั ัะทัะบะพะฒะฐั ะผะพะดะตะปั ะพั Anthropic
- ๐ฆ **ะคะพัะผะฐั Parquet** - ัะพััะฐะฝะตะฝะธะต ัะปะพะถะฝัั ัะธะฟะพะฒ ะดะฐะฝะฝัั ClickHouse

## ๐ ะัััััะน ััะฐัั

### 1. ะฃััะฐะฝะพะฒะบะฐ ะทะฐะฒะธัะธะผะพััะตะน

```bash
# ะกะพะทะดะฐัั ะฒะธัััะฐะปัะฝะพะต ะพะบััะถะตะฝะธะต
python3 -m venv venv
source venv/bin/activate

# ะฃััะฐะฝะพะฒะธัั ะทะฐะฒะธัะธะผะพััะธ
pip install -r requirements.txt
```

### 2. ะะฐัััะพะนะบะฐ ะบะพะฝัะธะณััะฐัะธะธ

```bash
# ะะพะฟะธัะพะฒะฐัั ัะฐะฑะปะพะฝ
cp .env.example .env

# ะััะตะดะฐะบัะธัะพะฒะฐัั .env ะธ ะทะฐะฟะพะปะฝะธัั:
# - ANTHROPIC_API_KEY
# - CLICKHOUSE_HOST, CLICKHOUSE_USER, CLICKHOUSE_PASSWORD
nano .env
```

### 3. ะกะบะฐัะฐัั SSL ัะตััะธัะธะบะฐั (ะดะปั ะฏะฝะดะตะบั Cloud)

```bash
wget https://storage.yandexcloud.net/cloud-certs/CA.pem -O YandexInternalRootCA.crt
```

### 4. ะะฐะฟัััะธัั ัะตััะพะฒัะน ะฐะณะตะฝั

```bash
python test_agent.py
```

## ๐ ะัะธะผะตัั ะทะฐะฟัะพัะพะฒ

```
โ ะะพะบะฐะถะธ ัะฟะธัะพะบ ะฒัะตั ัะฐะฑะปะธั ะฒ ะฑะฐะทะต ะดะฐะฝะฝัั

โ ะัะณััะทะธ ะฟะตัะฒัะต 100 ะทะฐะฟะธัะตะน ะธะท ัะฐะฑะปะธัั orders

โ ะะพะบะฐะถะธ ัะพะฟ-10 ัะพะฒะฐัะพะฒ ะฟะพ ะฒััััะบะต ะทะฐ ะฟะพัะปะตะดะฝะธะน ะผะตััั ะธ ะฟะพัััะพะน bar chart

โ ะะพััะธัะฐะน ะพะฑััั ะฒััััะบั ะฟะพ ะผะตัััะฐะผ ะทะฐ 2024 ะณะพะด ะธ ะฟะพัััะพะน line chart

โ ะัะพะฐะฝะฐะปะธะทะธััะน ะดะฐะฝะฝัะต ะธ ะฟะพะบะฐะถะธ ะพัะฝะพะฒะฝัะต ััะฐัะธััะธัะตัะบะธะต ะฟะพะบะฐะทะฐัะตะปะธ
```

## ๐๏ธ ะััะธัะตะบัััะฐ

```
โโโโโโโโโโโโโโโโโโโ
โ  ะะพะปัะทะพะฒะฐัะตะปั   โ
โโโโโโโโโโฌโโโโโโโโโ
         โ ะะฐะฟัะพั ะฝะฐ ะตััะตััะฒะตะฝะฝะพะผ ัะทัะบะต
         โผ
โโโโโโโโโโโโโโโโโโโ
โ  Claude Sonnet 4โ
โ   (Anthropic)   โ
โโโโโโโโโโฌโโโโโโโโโ
         โ ะะตัะฐะตั ะบะฐะบะธะต tools ะฒัะทะฒะฐัั
         โผ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ     Composite Agent             โ
โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโ   โ
โ  โ   list_tables           โ   โ ะะพะปััะธัั ััะตะผั ะะ
โ  โ   clickhouse_query      โ   โ ะัะณััะทะธัั ะดะฐะฝะฝัะต โ Parquet
โ  โ   python_analysis       โ   โ ะะฝะฐะปะธะท + ะณัะฐัะธะบะธ
โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโ   โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
         โ
         โผ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ  ะะตะทัะปััะฐั:                      โ
โ  โข ะขะตะบััะพะฒัะน ะพัะฒะตั (Markdown)    โ
โ  โข ะัะฐัะธะบะธ (base64 PNG)          โ
โ  โข ะขะฐะฑะปะธัั                       โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
```

## ๐ ะกัััะบัััะฐ ัะฐะนะปะพะฒ

```
agent_clickhouse_python_v1/
โโโ config.py                   # ะะพะฝัะธะณััะฐัะธั
โโโ clickhouse_client.py        # ะะปะธะตะฝั ClickHouse
โโโ python_sandbox.py           # ะัะฟะพะปะฝะตะฝะธะต Python ะบะพะดะฐ
โโโ chat_storage.py             # ะััะพัะธั ัะฐัะพะฒ (SQLite)
โโโ tools.py                    # ะะฟัะตะดะตะปะตะฝะธั tools ะดะปั Claude
โโโ composite_agent.py          # ะะปะฐะฒะฝัะน ะฐะณะตะฝั
โโโ test_agent.py               # ะขะตััะพะฒัะน ัะฐะนะป
โโโ requirements.txt            # ะะฐะฒะธัะธะผะพััะธ
โโโ .env.example                # ะจะฐะฑะปะพะฝ ะบะพะฝัะธะณััะฐัะธะธ
โโโ INSTALLATION.md             # ะะพะดัะพะฑะฝะฐั ะธะฝััััะบัะธั
โโโ README.md                   # ะญัะพั ัะฐะนะป
```

## ๐ง ะขะตัะฝะพะปะพะณะธะธ

- **Python 3.11+**
- **Claude Sonnet 4** (ัะตัะตะท Anthropic SDK)
- **ClickHouse** (ัะตัะตะท clickhouse-connect)
- **Pandas, NumPy** (ะฐะฝะฐะปะธะท ะดะฐะฝะฝัั)
- **Matplotlib, Seaborn** (ะฒะธะทัะฐะปะธะทะฐัะธั)
- **SQLite** (ะธััะพัะธั ะดะธะฐะปะพะณะฐ)
- **Parquet** (ัะพัะผะฐั ะดะฐะฝะฝัั)

## ๐ ะะพะดัะพะฑะฝะฐั ะดะพะบัะผะตะฝัะฐัะธั

### ะะพะบะฐะปัะฝะฐั ัััะฐะฝะพะฒะบะฐ ะธ ัะตััะธัะพะฒะฐะฝะธะต
- [INSTALLATION.md](INSTALLATION.md) - ะะพะดัะพะฑะฝะฐั ะธะฝััััะบัะธั ะฟะพ ัััะฐะฝะพะฒะบะต ะฝะฐ Ubuntu
- [QUICKSTART.md](QUICKSTART.md) - ะัััััะน ััะฐัั ะดะปั ะปะพะบะฐะปัะฝะพะณะพ ัะตััะธัะพะฒะฐะฝะธั

### ะะฐะทะฒะตัััะฒะฐะฝะธะต ะฝะฐ production ัะตัะฒะตัะต
- **[QUICKSTART_DEPLOYMENT.md](QUICKSTART_DEPLOYMENT.md)** - ะัะฐัะบะฐั ะธะฝััััะบัะธั ัะฐะทะฒะตัััะฒะฐะฝะธั (5 ะผะธะฝัั)
- **[DEPLOYMENT.md](DEPLOYMENT.md)** - ะะพะปะฝะพะต ััะบะพะฒะพะดััะฒะพ ะฟะพ ัะฐะทะฒะตัััะฒะฐะฝะธั ะฝะฐ server.asktab.ru (Beget)

ะะฝััััะบัะธะธ ะฟะพ ัะฐะทะฒะตัััะฒะฐะฝะธั ะฒะบะปััะฐัั:
- โ ะะฐัััะพะนะบั API ัะตัะฒะตัะฐ ั ะฐะฒัะพะทะฐะฟััะบะพะผ (systemd)
- โ ะะฐัััะพะนะบั ะฒะตะฑ-ัะตัะฒะตัะฐ nginx ั SSL (Let's Encrypt)
- โ ะะตะฑ-ะธะฝัะตััะตะนั ะดะปั ัะตััะธัะพะฒะฐะฝะธั API
- โ ะะพะฝะธัะพัะธะฝะณ, ะปะพะณะธ ะธ ััััะฐะฝะตะฝะธะต ะฝะตะฟะพะปะฐะดะพะบ
- โ ะะฐัััะพะนะบั ะฑะฐะทั ะดะฐะฝะฝัั ClickHouse

## ๐ก ะะฐะบ ััะพ ัะฐะฑะพัะฐะตั

1. **ะะพะปัะทะพะฒะฐัะตะปั** ะฟะธัะตั ะทะฐะฟัะพั ะฝะฐ ััััะบะพะผ ัะทัะบะต
2. **Claude** ะฐะฝะฐะปะธะทะธััะตั ะทะฐะฟัะพั ะธ ัะตัะฐะตั:
   - ะัะถะฝะพ ะปะธ ะฟะพัะผะพััะตัั ััะตะผั ะะ? โ `list_tables`
   - ะัะถะฝะพ ะปะธ ะฒัะณััะทะธัั ะดะฐะฝะฝัะต? โ `clickhouse_query`
   - ะัะถะฝะพ ะปะธ ะฟัะพะฐะฝะฐะปะธะทะธัะพะฒะฐัั/ะฒะธะทัะฐะปะธะทะธัะพะฒะฐัั? โ `python_analysis`
3. **ะะณะตะฝั** ะฒัะฟะพะปะฝัะตั ะฝะตะพะฑัะพะดะธะผัะต ะธะฝััััะผะตะฝัั:
   - ะัะณััะถะฐะตั ะดะฐะฝะฝัะต ะธะท ClickHouse ะฒ Parquet
   - ะัะฟะพะปะฝัะตั Python ะบะพะด ะดะปั ะฐะฝะฐะปะธะทะฐ
   - ะะฐัะฒะฐััะฒะฐะตั ะณัะฐัะธะบะธ matplotlib
4. **Claude** ัะพัะผะธััะตั ะฟะพะฝััะฝัะน ะพัะฒะตั ั ะฒัะฒะพะดะฐะผะธ
5. **ะััะพัะธั** ัะพััะฐะฝัะตััั ะดะปั ะฟัะพะดะพะปะถะตะฝะธั ะดะธะฐะปะพะณะฐ

## ๐จ ะัะพะฑะตะฝะฝะพััะธ

### ะะพัะตะผั Parquet, ะฐ ะฝะต CSV?

ClickHouse ะธะผะตะตั ัะปะพะถะฝัะต ัะธะฟั ะดะฐะฝะฝัั:
- `Array(String)` - ะผะฐััะธะฒั
- `Map(String, UInt64)` - ัะปะพะฒะฐัะธ
- `Tuple(Int32, String)` - ะบะพััะตะถะธ

CSV ะฝะต ะผะพะถะตั ะบะพััะตะบัะฝะพ ัะพััะฐะฝะธัั ััะธ ัะธะฟั, ะฐ Parquet ัะพััะฐะฝัะตั ะธั ะฝะฐัะธะฒะฝะพ.

### ะะฒัะพะผะฐัะธัะตัะบะธะน retry ะฟัะธ ะพัะธะฑะบะฐั

ะัะปะธ Python ะบะพะด ัะฟะฐะป ั ะพัะธะฑะบะพะน, Claude **ะฒะธะดะธั ะพัะธะฑะบั** ะธ **ะฐะฒัะพะผะฐัะธัะตัะบะธ ะธัะฟัะฐะฒะปัะตั ะบะพะด** ะฒ ัะปะตะดัััะตะน ะธัะตัะฐัะธะธ.

### ะกะบะพะปัะทััะตะต ะพะบะฝะพ ะธััะพัะธะธ

ะะปั ะบะฐะถะดะพะน ัะตััะธะธ ััะฐะฝะธััั ัะพะปัะบะพ ะฟะพัะปะตะดะฝะธะต 20 ัะพะพะฑัะตะฝะธะน, ััะพ:
- ะญะบะพะฝะพะผะธั ะผะตััะพ ะฒ ะะ
- ะกะพััะฐะฝัะตั ะฐะบััะฐะปัะฝัะน ะบะพะฝัะตะบัั
- ะัะตะดะพัะฒัะฐัะฐะตั ัะฐะทะดัะฒะฐะฝะธะต ะบะพะฝัะตะบััะฐ Claude

## ๐ ะะตะทะพะฟะฐัะฝะพััั

- SQL ะธะฝัะตะบัะธะธ ะฟัะตะดะพัะฒัะฐัะตะฝั (ัะพะปัะบะพ SELECT ะทะฐะฟัะพัั)
- Python ะบะพะด ะฒัะฟะพะปะฝัะตััั ะฒ ะธะทะพะปะธัะพะฒะฐะฝะฝะพะผ namespace
- ะะฐะทะฐ ะดะฐะฝะฝัั ะดะพัััะฟะฝะฐ ัะพะปัะบะพ ะดะปั ััะตะฝะธั
- SSL ะฟะพะดะบะปััะตะฝะธะต ะบ ClickHouse

## ๐ ะัะธะผะตัั ัะฐะฑะพัั

### ะะฐะฟัะพั: "ะะพะบะฐะถะธ ัะพะฟ-10 ัะพะฒะฐัะพะฒ ะฟะพ ะฒััััะบะต"

**ะงัะพ ะดะตะปะฐะตั ะฐะณะตะฝั:**
1. ะัะทัะฒะฐะตั `list_tables` ััะพะฑั ัะทะฝะฐัั ััััะบัััั
2. ะัะทัะฒะฐะตั `clickhouse_query` ั SQL:
   ```sql
   SELECT product_name, SUM(revenue) as total_revenue
   FROM orders
   GROUP BY product_name
   ORDER BY total_revenue DESC
   LIMIT 10
   ```
3. ะัะทัะฒะฐะตั `python_analysis` ะดะปั ัะพะทะดะฐะฝะธั bar chart
4. ะะพะทะฒัะฐัะฐะตั ัะฐะฑะปะธัั ะธ ะณัะฐัะธะบ

### ะะฐะฟัะพั: "ะะพัััะพะน line chart ะฟัะพะดะฐะถ ะฟะพ ะผะตัััะฐะผ"

**ะงัะพ ะดะตะปะฐะตั ะฐะณะตะฝั:**
1. ะัะณััะถะฐะตั ะดะฐะฝะฝัะต ั ะฐะณัะตะณะฐัะธะตะน ะฟะพ ะผะตัััะฐะผ
2. ะกะพะทะดะฐะตั ะณัะฐัะธะบ ั matplotlib
3. ะะพะดะฟะธััะฒะฐะตั ะพัะธ ะฝะฐ ััััะบะพะผ ัะทัะบะต
4. ะคะพัะผะฐัะธััะตั ัะธัะปะฐ ั ัะฐะทะดะตะปะธัะตะปัะผะธ ััััั
5. ะะพะทะฒัะฐัะฐะตั ะณัะฐัะธะบ ะธ ะฐะฝะฐะปะธะท

## ๐ ะะฐะทะฒะตัััะฒะฐะฝะธะต ะฝะฐ production

ะัะพะตะบั ะณะพัะพะฒ ะดะปั ัะฐะทะฒะตัััะฒะฐะฝะธั ะฝะฐ production ัะตัะฒะตัะต!

**ะฃะถะต ัะตะฐะปะธะทะพะฒะฐะฝะพ:**
- โ FastAPI ัะตัะฒะตั ะดะปั HTTP API
- โ ะะตะฑ-ะธะฝัะตััะตะนั ะดะปั ะพะฑัะตะฝะธั ั ะฐะณะตะฝัะพะผ
- โ Systemd ัะตัะฒะธั ะดะปั ะฐะฒัะพะทะฐะฟััะบะฐ
- โ ะะพะฝัะธะณััะฐัะธั nginx ั SSL
- โ ะะพะปะฝะฐั ะดะพะบัะผะตะฝัะฐัะธั ะฟะพ ัะฐะทะฒะตัััะฒะฐะฝะธั

**ะกะปะตะดัััะธะต ัะฐะณะธ:**
- [ ] Docker ะบะพะฝัะตะนะฝะตั ะดะปั ะดะตะฟะปะพั
- [ ] ะะฐััะธัะตะฝะฝะฐั ะฐะฝะฐะปะธัะธะบะฐ (ML ะผะพะดะตะปะธ)
- [ ] ะััะตะฝัะธัะธะบะฐัะธั ะฟะพะปัะทะพะฒะฐัะตะปะตะน

ะกะผะพััะธัะต [QUICKSTART_DEPLOYMENT.md](QUICKSTART_DEPLOYMENT.md) ะดะปั ะฑััััะพะณะพ ัะฐะทะฒะตัััะฒะฐะฝะธั.

## ๐ ะกะฟะตัะธัะธะบะฐัะธั

ะะพะปะฝะฐั ัะฟะตัะธัะธะบะฐัะธั ัะตะฐะปะธะทะฐัะธะธ ะฝะฐัะพะดะธััั ะฒ ัะฐะนะปะต [FULL_IMPLEMENTATION_SPEC.md](FULL_IMPLEMENTATION_SPEC.md)

## ๐ค ะะบะปะฐะด

ะญัะพั ะฟัะพะตะบั ัะพะทะดะฐะฝ ะฝะฐ ะพัะฝะพะฒะต:
- **CLI ะฐะณะตะฝั ClickHouse** - ัะฐะฑะพัะฐ ั ะฑะฐะทะพะน ะดะฐะฝะฝัั
- **Julius v2** - Python ะฐะฝะฐะปะธะท ะธ ะณัะฐัะธะบะธ

ะะฑัะตะดะธะฝะตะฝะธะต ะดะฒัั ะฐะณะตะฝัะพะฒ ะฒ ะพะดะธะฝ ะผะพัะฝัะน ะธะฝััััะผะตะฝั ะดะปั ะฐะฝะฐะปะธะทะฐ ะดะฐะฝะฝัั.

## ๐ ะะพะดะดะตัะถะบะฐ

ะัะปะธ ะฒะพะทะฝะธะบะปะธ ะฒะพะฟัะพัั ะธะปะธ ะฟัะพะฑะปะตะผั:
1. ะัะพะฒะตัััะต [INSTALLATION.md](INSTALLATION.md)
2. ะะพัะผะพััะธัะต ะปะพะณะธ ะฒ ะบะพะฝัะพะปะธ
3. ะกะพะทะดะฐะนัะต Issue ะฒ GitHub

---

**ะกะพะทะดะฐะฝะพ ั ะธัะฟะพะปัะทะพะฒะฐะฝะธะตะผ Claude Sonnet 4** ๐ค
