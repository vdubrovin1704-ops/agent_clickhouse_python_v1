# Changelog API v2.1

## –î–∞—Ç–∞: –ò—é–Ω—å 2025

---

## üìã –ö—Ä–∞—Ç–∫–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ –∏–∑–º–µ–Ω–µ–Ω–∏–π

API —Ç–µ–ø–µ—Ä—å –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç **Excel —Ñ–∞–π–ª—ã** –∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç **—Ä–∞–∑–¥–µ–ª–∏—Ç–µ–ª—å `;`** –≤ –≤–æ–∑–≤—Ä–∞—â–∞–µ–º—ã—Ö CSV –¥–ª—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–≥–æ –æ—Ç–∫—Ä—ã—Ç–∏—è –≤ Windows Excel.

---

## üîÑ –ò–∑–º–µ–Ω–µ–Ω–∏—è –¥–ª—è —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥–∞

### 1. –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –Ω–æ–≤—ã—Ö —Ñ–æ—Ä–º–∞—Ç–æ–≤ —Ñ–∞–π–ª–æ–≤

**–ë—ã–ª–æ:** –ü—Ä–∏–Ω–∏–º–∞–ª–∏—Å—å —Ç–æ–ª—å–∫–æ `.csv` —Ñ–∞–π–ª—ã

**–°—Ç–∞–ª–æ:** –ü—Ä–∏–Ω–∏–º–∞—é—Ç—Å—è —Ñ–æ—Ä–º–∞—Ç—ã:
- `.csv` - CSV —Ñ–∞–π–ª—ã (–∫–∞–∫ —Ä–∞–Ω—å—à–µ)
- `.xlsx` - Excel 2007+ (–æ—Å–Ω–æ–≤–Ω–æ–π —Ñ–æ—Ä–º–∞—Ç)
- `.xls` - Excel 97-2003 (—É—Å—Ç–∞—Ä–µ–≤—à–∏–π —Ñ–æ—Ä–º–∞—Ç)
- `.xlsm` - Excel —Å –º–∞–∫—Ä–æ—Å–∞–º–∏

#### –ß—Ç–æ –Ω—É–∂–Ω–æ –∏–∑–º–µ–Ω–∏—Ç—å –≤–æ —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥–µ:

```typescript
// –û–±–Ω–æ–≤–∏—Ç—å accept –≤ input —Ñ–∞–π–ª–∞
<input 
  type="file" 
  accept=".csv,.xlsx,.xls,.xlsm" 
/>

// –û–±–Ω–æ–≤–∏—Ç—å –≤–∞–ª–∏–¥–∞—Ü–∏—é –Ω–∞ –∫–ª–∏–µ–Ω—Ç–µ
const ALLOWED_EXTENSIONS = ['.csv', '.xlsx', '.xls', '.xlsm'];

function isValidFile(filename: string): boolean {
  const ext = filename.slice(filename.lastIndexOf('.')).toLowerCase();
  return ALLOWED_EXTENSIONS.includes(ext);
}
```

---

### 2. –ò–∑–º–µ–Ω–µ–Ω–∏–µ —Ñ–æ—Ä–º–∞—Ç–∞ –≤–æ–∑–≤—Ä–∞—â–∞–µ–º–æ–≥–æ CSV

**–ë—ã–ª–æ:** CSV —Å —Ä–∞–∑–¥–µ–ª–∏—Ç–µ–ª–µ–º `,` (–∑–∞–ø—è—Ç–∞—è)

**–°—Ç–∞–ª–æ:** CSV —Å —Ä–∞–∑–¥–µ–ª–∏—Ç–µ–ª–µ–º `;` (—Ç–æ—á–∫–∞ —Å –∑–∞–ø—è—Ç–æ–π)

#### –ü–æ—á–µ–º—É —ç—Ç–æ –∏–∑–º–µ–Ω–µ–Ω–∏–µ:
- –í Windows Excel (—Ä—É—Å—Å–∫–∞—è/–µ–≤—Ä–æ–ø–µ–π—Å–∫–∞—è –ª–æ–∫–∞–ª—å) –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é —Ä–∞–∑–¥–µ–ª–∏—Ç–µ–ª—å `;`
- –ó–∞–ø—è—Ç–∞—è –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –∫–∞–∫ –¥–µ—Å—è—Ç–∏—á–Ω—ã–π —Ä–∞–∑–¥–µ–ª–∏—Ç–µ–ª—å –≤ —ç—Ç–∏—Ö –ª–æ–∫–∞–ª—è—Ö
- –¢–µ–ø–µ—Ä—å —Ñ–∞–π–ª—ã –æ—Ç–∫—Ä—ã–≤–∞—é—Ç—Å—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ –±–µ–∑ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã—Ö –Ω–∞—Å—Ç—Ä–æ–µ–∫

#### –ß—Ç–æ –Ω—É–∂–Ω–æ –∏–∑–º–µ–Ω–∏—Ç—å –≤–æ —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥–µ:

```typescript
// –ï—Å–ª–∏ –ø–∞—Ä—Å–∏—Ç–µ CSV –Ω–∞ –∫–ª–∏–µ–Ω—Ç–µ - –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ sep=";"
function parseCSV(csvString: string): string[][] {
  return csvString.split('\n').map(row => row.split(';'));
}

// –î–ª—è —Å–∫–∞—á–∏–≤–∞–Ω–∏—è —Ñ–∞–π–ª–∞ - –¥–æ–±–∞–≤—å—Ç–µ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–µ .csv
// –§–∞–π–ª –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ—Ç–∫—Ä–æ–µ—Ç—Å—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ –≤ Excel
function downloadCSV(base64Data: string, filename: string) {
  const link = document.createElement('a');
  link.href = `data:text/csv;charset=utf-8-sig;base64,${base64Data}`;
  link.download = filename.endsWith('.csv') ? filename : `${filename}.csv`;
  link.click();
}
```

---

### 3. –ù–æ–≤–æ–µ –ø–æ–ª–µ –≤ –æ—Ç–≤–µ—Ç–µ API

–í `load_info` –¥–æ–±–∞–≤–ª–µ–Ω–æ –Ω–æ–≤–æ–µ –ø–æ–ª–µ `file_format`:

```json
{
  "load_info": {
    "filename": "data.xlsx",
    "file_format": "excel",  // NEW! "csv" –∏–ª–∏ "excel"
    "steps": [...],
    "original_shape": [100, 5],
    "final_shape": [98, 5],
    "success": true
  }
}
```

#### –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ:

```typescript
interface LoadInfo {
  filename: string;
  file_format: 'csv' | 'excel';  // NEW!
  steps: string[];
  warnings: string[];
  original_shape: [number, number] | null;
  final_shape: [number, number] | null;
  success: boolean;
}

// –ú–æ–∂–Ω–æ –ø–æ–∫–∞–∑–∞—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é –∫–∞–∫–æ–π —Ñ–æ—Ä–º–∞—Ç –±—ã–ª –∑–∞–≥—Ä—É–∂–µ–Ω
const formatLabel = response.load_info.file_format === 'excel' 
  ? 'üìä Excel' 
  : 'üìÑ CSV';
```

---

## üîß –û–±–Ω–æ–≤–ª—ë–Ω–Ω—ã–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ (—Å–µ—Ä–≤–µ—Ä–Ω–∞—è —á–∞—Å—Ç—å)

–î–æ–±–∞–≤–ª–µ–Ω—ã –±–∏–±–ª–∏–æ—Ç–µ–∫–∏ –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å Excel:
- `openpyxl>=3.1.0` - –¥–ª—è `.xlsx` –∏ `.xlsm` —Ñ–∞–π–ª–æ–≤
- `xlrd>=2.0.0` - –¥–ª—è `.xls` —Ñ–∞–π–ª–æ–≤

**–ö–æ–º–∞–Ω–¥–∞ –¥–ª—è —É—Å—Ç–∞–Ω–æ–≤–∫–∏:**
```bash
pip install -r requirements_api.txt
```

---

## üìù –ü—Ä–∏–º–µ—Ä—ã –∑–∞–ø—Ä–æ—Å–æ–≤

### –ó–∞–≥—Ä—É–∑–∫–∞ Excel —Ñ–∞–π–ª–∞:

```bash
curl -X POST "http://localhost:8000/api/analyze" \
  -F "file=@data.xlsx" \
  -F "query=–ü–æ–∫–∞–∂–∏ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É –ø–æ –ø—Ä–æ–¥–∞–∂–∞–º"
```

### –ó–∞–≥—Ä—É–∑–∫–∞ CSV —Ñ–∞–π–ª–∞ (–∫–∞–∫ —Ä–∞–Ω—å—à–µ):

```bash
curl -X POST "http://localhost:8000/api/analyze" \
  -F "file=@data.csv" \
  -F "query=–ü–æ—Å—Ç—Ä–æ–π –≥—Ä–∞—Ñ–∏–∫"
```

---

## ‚ö†Ô∏è –í–∞–∂–Ω—ã–µ –∑–∞–º–µ—á–∞–Ω–∏—è

### 1. Excel —á–∏—Ç–∞–µ—Ç —Ç–æ–ª—å–∫–æ –ø–µ—Ä–≤—ã–π –ª–∏—Å—Ç
–ï—Å–ª–∏ Excel —Ñ–∞–π–ª —Å–æ–¥–µ—Ä–∂–∏—Ç –Ω–µ—Å–∫–æ–ª—å–∫–æ –ª–∏—Å—Ç–æ–≤, –±—É–¥–µ—Ç –∑–∞–≥—Ä—É–∂–µ–Ω —Ç–æ–ª—å–∫–æ **–ø–µ—Ä–≤—ã–π –ª–∏—Å—Ç**. –≠—Ç–æ –ø–æ–≤–µ–¥–µ–Ω–∏–µ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç —Ç–µ–∫—É—â–µ–π –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–µ (–æ–¥–∏–Ω —Ñ–∞–π–ª = –æ–¥–∏–Ω –∞–Ω–∞–ª–∏–∑).

### 2. –û–±—Ä–∞—Ç–Ω–∞—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å
- –°—Ç–∞—Ä—ã–µ –∑–∞–ø—Ä–æ—Å—ã —Å `.csv` —Ñ–∞–π–ª–∞–º–∏ —Ä–∞–±–æ—Ç–∞—é—Ç –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π
- –ú–µ—Ç–æ–¥ `smart_load_csv()` –ø–æ-–ø—Ä–µ–∂–Ω–µ–º—É —Ä–∞–±–æ—Ç–∞–µ—Ç (–∞–ª–∏–∞—Å –¥–ª—è `smart_load_file()`)
- –í—Å–µ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ endpoints —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã

### 3. –ö–æ–¥–∏—Ä–æ–≤–∫–∞
- –í–æ–∑–≤—Ä–∞—â–∞–µ–º—ã–π CSV –∏—Å–ø–æ–ª—å–∑—É–µ—Ç `UTF-8-SIG` (—Å BOM)
- –≠—Ç–æ –≥–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–µ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –∫–∏—Ä–∏–ª–ª–∏—Ü—ã –≤ Excel

---

## üìä –°—Ä–∞–≤–Ω–∏—Ç–µ–ª—å–Ω–∞—è —Ç–∞–±–ª–∏—Ü–∞

| –ê—Å–ø–µ–∫—Ç | v2.0 | v2.1 |
|--------|------|------|
| CSV —Ñ–∞–π–ª—ã | ‚úÖ | ‚úÖ |
| Excel —Ñ–∞–π–ª—ã | ‚ùå | ‚úÖ (.xlsx, .xls, .xlsm) |
| CSV —Ä–∞–∑–¥–µ–ª–∏—Ç–µ–ª—å | `,` (–∑–∞–ø—è—Ç–∞—è) | `;` (—Ç–æ—á–∫–∞ —Å –∑–∞–ø—è—Ç–æ–π) |
| Excel —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å | ‚ö†Ô∏è –¢—Ä–µ–±—É–µ—Ç –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ | ‚úÖ –†–∞–±–æ—Ç–∞–µ—Ç —Å—Ä–∞–∑—É |
| –ö–æ–¥–∏—Ä–æ–≤–∫–∞ | UTF-8-SIG | UTF-8-SIG |

---

## üöÄ Checklist –¥–ª—è —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥–∞

- [ ] –û–±–Ω–æ–≤–∏—Ç—å `accept` –≤ file input –Ω–∞ `.csv,.xlsx,.xls,.xlsm`
- [ ] –û–±–Ω–æ–≤–∏—Ç—å –≤–∞–ª–∏–¥–∞—Ü–∏—é —Ñ–∞–π–ª–æ–≤ –Ω–∞ –∫–ª–∏–µ–Ω—Ç–µ
- [ ] –ï—Å–ª–∏ –ø–∞—Ä—Å–∏—Ç–µ CSV –Ω–∞ –∫–ª–∏–µ–Ω—Ç–µ - –∏–∑–º–µ–Ω–∏—Ç—å —Ä–∞–∑–¥–µ–ª–∏—Ç–µ–ª—å –Ω–∞ `;`
- [ ] –û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ: –ø–æ–∫–∞–∑—ã–≤–∞—Ç—å `file_format` –≤ UI
- [ ] –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –∑–∞–≥—Ä—É–∑–∫—É Excel —Ñ–∞–π–ª–æ–≤
- [ ] –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å —Å–∫–∞—á–∏–≤–∞–Ω–∏–µ CSV (–¥–æ–ª–∂–µ–Ω –æ—Ç–∫—Ä—ã–≤–∞—Ç—å—Å—è –≤ Excel –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ)

---

## ü§ù –ö–æ–Ω—Ç–∞–∫—Ç—ã

–ü—Ä–∏ –≤–æ–∑–Ω–∏–∫–Ω–æ–≤–µ–Ω–∏–∏ –≤–æ–ø—Ä–æ—Å–æ–≤ –ø–æ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ –æ–±—Ä–∞—â–∞–π—Ç–µ—Å—å –∫ backend-—Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫—É.
